<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AnimeNEXUS</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0D1117;--surface:#161B22;--primary:#00FFFF;--accent:#FF0066;--text:#E6EDF3;--sub:#8B949E;--radius:12px;--transition:.3s ease}
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif}
    a{color:inherit;text-decoration:none}
    button{font-family:inherit;border:none;background:none;cursor:pointer}
    .navbar{position:fixed;top:0;left:0;width:100%;z-index:100;background:rgba(13,17,23,.8);backdrop-filter:blur(10px);border-bottom:1px solid rgba(0,255,255,.1)}
    .nav-container{max-width:1400px;margin:0 auto;display:flex;align-items:center;padding:.75rem 1.5rem}
    .logo{font-family:'Poppins',sans-serif;font-weight:700;font-size:1.5rem;letter-spacing:1px}
    .logo-accent{color:var(--primary)}
    .nav-links{display:flex;gap:2rem;margin-left:auto}
    .nav-links a{position:relative;padding:.25rem 0;font-weight:600;color:var(--sub);transition:color var(--transition)}
    .nav-links a::after{content:'';position:absolute;bottom:-4px;left:0;width:0;height:2px;background:var(--primary);transition:width var(--transition)}
    .nav-links a:hover{color:var(--text)}.nav-links a:hover::after{width:100%}
    .nav-right{display:flex;align-items:center;gap:1rem;margin-left:2rem}
    .search-icon{width:24px;height:24px;fill:var(--sub);cursor:pointer;transition:fill var(--transition)}
    .search-icon:hover{fill:var(--primary)}
    .login-btn{padding:.5rem 1.25rem;border:1px solid var(--primary);border-radius:var(--radius);color:var(--primary);font-weight:600;transition:background var(--transition),color var(--transition)}
    .login-btn:hover{background:var(--primary);color:var(--bg)}
    .hero{position:relative;height:100vh;min-height:600px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .hero-video{position:absolute;top:50%;left:50%;min-width:100%;min-height:100%;transform:translate(-50%,-50%);object-fit:cover;z-index:-2}
    .hero-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(13,17,23,0) 60%,var(--bg) 100%);z-index:-1}
    .hero-text{text-align:center;max-width:700px;padding:0 1rem;z-index:2}
    .hero-title{font-family:'Poppins',sans-serif;font-size:clamp(3rem,8vw,5rem);font-weight:700;letter-spacing:2px;text-shadow:0 0 10px var(--primary),0 0 20px var(--accent)}
    .hero-synopsis{margin:1rem 0 2rem;font-size:1.1rem;color:var(--sub)}
    .cta-btn{padding:1rem 2.5rem;background:var(--primary);color:var(--bg);border-radius:var(--radius);font-weight:700;font-size:1.1rem;box-shadow:0 0 20px rgba(0,255,255,.5);transition:transform var(--transition),box-shadow var(--transition)}
    .cta-btn:hover{transform:translateY(-3px);box-shadow:0 0 30px rgba(0,255,255,.7)}
    .shelves{padding:4rem 1rem 2rem;max-width:1400px;margin:0 auto}
    .shelf{margin-bottom:3rem}
    .shelf-title{font-family:'Poppins',sans-serif;font-size:1.5rem;margin-bottom:1rem;letter-spacing:1px}
    .shelf-scroll{overflow:hidden}
    .shelf-track{display:flex;gap:1rem;animation:scroll 30s linear infinite}
    .shelf-item{flex:0 0 auto;width:160px;border-radius:var(--radius);overflow:hidden;position:relative;background:var(--surface);transition:transform var(--transition),box-shadow var(--transition)}
    .shelf-item:hover{transform:translateY(-6px);box-shadow:0 0 20px rgba(0,255,255,.4)}
    .shelf-item img{width:100%;display:block}
    .shelf-meta{padding:.75rem;font-size:.9rem}
    .shelf-meta .title{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .shelf-meta .ep{color:var(--sub);font-size:.8rem}
    .upload-btn{padding:.5rem 1rem;background:var(--accent);color:#fff;border-radius:var(--radius);font-weight:600;cursor:pointer;transition:all var(--transition)}
    .upload-btn:hover{transform:translateY(-2px);box-shadow:0 0 15px rgba(255,0,102,.5)}
    .upload-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:200;align-items:center;justify-content:center}
    .upload-modal.active{display:flex}
    .upload-form{background:var(--surface);border-radius:var(--radius);padding:2rem;max-width:600px;width:90%}
    .upload-form h2{margin-bottom:1.5rem;color:var(--primary)}
    .form-group{margin-bottom:1.5rem}
    .form-group label{display:block;margin-bottom:.5rem;font-weight:600}
    .form-group input,.form-group textarea{width:100%;padding:.75rem;background:rgba(0,255,255,.05);border:1px solid rgba(0,255,255,.2);border-radius:var(--radius);color:var(--text);font-family:inherit;font-size:.95rem}
    .form-group textarea{resize:vertical;min-height:80px}
    .file-input-wrapper{position:relative;overflow:hidden;display:inline-block;width:100%}
    .file-input-wrapper input{position:absolute;left:-9999px}
    .file-input-label{display:block;padding:.75rem;background:rgba(0,255,255,.1);border:2px dashed var(--primary);border-radius:var(--radius);text-align:center;cursor:pointer;transition:all var(--transition)}
    .file-input-label:hover{background:rgba(0,255,255,.2)}
    .file-input-label.dragover{background:rgba(0,255,255,.3)}
    .form-buttons{display:flex;gap:1rem;justify-content:flex-end}
    .btn-submit{padding:.75rem 1.5rem;background:var(--primary);color:var(--bg);border-radius:var(--radius);font-weight:600;cursor:pointer;transition:all var(--transition)}
    .btn-submit:hover{transform:translateY(-2px);box-shadow:0 0 15px rgba(0,255,255,.5)}
    .btn-cancel{padding:.75rem 1.5rem;background:transparent;border:1px solid var(--sub);color:var(--sub);border-radius:var(--radius);font-weight:600;cursor:pointer;transition:all var(--transition)}
    .btn-cancel:hover{color:var(--primary);border-color:var(--primary)}
    .uploaded-videos{margin-top:2rem}
    .uploaded-videos h3{color:var(--primary);margin-bottom:1rem}
    .video-item{background:rgba(0,255,255,.05);padding:1rem;border-radius:var(--radius);margin-bottom:.5rem;display:flex;justify-content:space-between;align-items:center}
    .video-item-info{flex:1}
    .video-item-title{font-weight:600}
    .video-item-size{color:var(--sub);font-size:.85rem}
    .btn-delete{padding:.35rem .75rem;background:var(--accent);color:#fff;border:none;border-radius:var(--radius);cursor:pointer;font-size:.85rem;transition:all var(--transition)}
    .btn-delete:hover{transform:translateY(-1px);box-shadow:0 0 10px rgba(255,0,102,.5)}
    .footer-container{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
    .socials{display:flex;gap:1rem}
    .socials a{color:var(--sub);transition:color var(--transition)}
    .socials a:hover{color:var(--primary)}
    @keyframes scroll{to{transform:translateX(-50%)}}
    .watch-page{display:none;padding-top:80px;min-height:100vh}
    .watch-page.active{display:block}
    .watch-container{max-width:1400px;margin:0 auto;padding:2rem}
    .back-btn{display:inline-block;margin-bottom:2rem;padding:.5rem 1rem;border:1px solid var(--primary);border-radius:var(--radius);color:var(--primary);cursor:pointer;transition:all var(--transition)}
    .back-btn:hover{background:var(--primary);color:var(--bg)}
    .video-section{display:grid;grid-template-columns:1fr 300px;gap:2rem;margin-bottom:3rem}
    .video-player{background:var(--surface);border-radius:var(--radius);aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
    .video-player iframe{width:100%;height:100%;border:none}
    .video-player video{width:100%;height:100%;border:none;object-fit:contain}
    .video-info{display:flex;flex-direction:column;gap:1.5rem}
    .anime-poster{width:100%;max-width:300px;height:auto;border-radius:var(--radius);box-shadow:0 0 20px rgba(0,255,255,.3);overflow:hidden}
    .anime-poster img{width:100%;height:auto;display:block}
    .anime-title{font-family:'Poppins',sans-serif;font-size:1.8rem;font-weight:700}
    .episode-num{color:var(--sub);font-size:.95rem}
    .anime-description{color:var(--sub);font-size:.95rem;line-height:1.6}
    .episodes-list{background:var(--surface);border-radius:var(--radius);padding:1.5rem;max-height:500px;overflow-y:auto}
    .episodes-list h3{margin-bottom:1rem;color:var(--primary)}
    .episode-btn{display:block;width:100%;padding:.75rem;margin-bottom:.5rem;background:rgba(0,255,255,.1);border:1px solid rgba(0,255,255,.2);border-radius:var(--radius);color:var(--text);text-align:left;cursor:pointer;transition:all var(--transition);font-size:.9rem}
    .episode-btn:hover{background:var(--primary);color:var(--bg);border-color:var(--primary)}
    .episode-btn.active{background:var(--primary);color:var(--bg);border-color:var(--primary)}
    .home-page{display:block}
    .home-page.hidden{display:none}
    @keyframes scroll{to{transform:translateX(-50%)}}
    @media(max-width:900px){.nav-links{display:none}.hero-title{font-size:3rem}.shelf-track{animation:none;overflow-x:auto;scroll-snap-type:x mandatory}.shelf-item{scroll-snap-align:start}.video-section{grid-template-columns:1fr;gap:1rem}.episodes-list{max-height:300px}}
  </style>
</head>
<body>

<nav class="navbar">
  <div class="nav-container">
    <div class="logo" onclick="goHome()" style="cursor:pointer">ANIME<span class="logo-accent">NEXUS</span></div>
    <ul class="nav-links">
      <li><a href="#" onclick="goHome();return false">Home</a></li><li><a href="#" onclick="showAllAnime();return false">Watch</a></li><li><a href="#">Library</a></li><li><a href="#">News</a></li>
    </ul>
    <div class="nav-right">
      <svg class="search-icon" viewBox="0 0 24 24"><path d="M10 2a8 8 0 106.32 13.32l4.2 4.2a1 1 0 001.42-1.42l-4.2-4.2A8 8 0 0010 2zm0 14a6 6 0 110-12 6 6 0 010 12z"/></svg>
      <button class="upload-btn" onclick="openUploadModal()">üì§ Upload Video</button>
      <button class="login-btn">Sign In</button>
    </div>
  </div>
</nav>

<section class="hero">
  <video autoplay muted loop playsinline class="hero-video">
    <source src="https://cdn.coverr.co/videos/coverr-a neon cityscape at night-9757/1080p.mp4" type="video/mp4">
  </video>
  <div class="hero-overlay"></div>
  <div class="hero-text">
    <h1 class="hero-title">CYBER RE:BORN</h1>
    <p class="hero-synopsis">In 2099 Neo-Kyoto, a rogue AI resurrects a dead hacker to stop an impending digital apocalypse.</p>
    <button class="cta-btn" onclick="watchAnime('Cyber Re:Born')">Watch Now</button>
  </div>
</section>

<main class="home-page" id="homePage">
  <div class="shelves">
    <section class="shelf" data-shelf="trending">
      <h2 class="shelf-title">Trending Now</h2>
      <div class="shelf-scroll"><div class="shelf-track"></div></div>
    </section>
    <section class="shelf" data-shelf="new">
      <h2 class="shelf-title">New Episodes Today</h2>
      <div class="shelf-scroll"><div class="shelf-track"></div></div>
    </section>
    <section class="shelf" data-shelf="classics">
      <h2 class="shelf-title">Must-Watch Classics</h2>
      <div class="shelf-scroll"><div class="shelf-track"></div></div>
    </section>
  </div>
</main>

<div class="watch-page" id="watchPage">
  <div class="watch-container">
    <button class="back-btn" onclick="goHome()">‚Üê Back to Home</button>
    <div class="video-section">
      <div class="video-player" id="videoPlayer"></div>
      <div class="episodes-list" id="episodesList"></div>
    </div>
  </div>
</div>

<div class="upload-modal" id="uploadModal">
  <div class="upload-form">
    <h2>Upload Anime Video</h2>
    <div class="form-group">
      <label for="animeTitle">Anime Title</label>
      <input type="text" id="animeTitle" placeholder="e.g., My Anime Show">
    </div>
    <div class="form-group">
      <label for="episodeNum">Episode Number</label>
      <input type="number" id="episodeNum" min="1" placeholder="1">
    </div>
    <div class="form-group">
      <label for="description">Description</label>
      <textarea id="description" placeholder="Describe this episode..."></textarea>
    </div>
    <div class="form-group">
      <label>Video File</label>
      <div class="file-input-wrapper">
        <label class="file-input-label" for="videoFile" id="dragZone">
          <span>üìÅ Click to upload or drag & drop (MP4, MKV, WebM)</span>
        </label>
        <input type="file" id="videoFile" accept="video/*">
      </div>
      <div id="uploadedVideos" class="uploaded-videos"></div>
    </div>
    <div class="form-buttons">
      <button class="btn-cancel" onclick="closeUploadModal()">Cancel</button>
      <button class="btn-submit" onclick="uploadVideo()">Upload</button>
    </div>
  </div>
</div>

<footer class="footer">
  <div class="footer-container">
    <small>¬© 2025 AnimeNEXUS</small>
    <div class="socials">
      <a href="#">Twitter</a><a href="#">Discord</a><a href="#">GitHub</a>
    </div>
  </div>
</footer>

<script>
// IndexedDB for storing uploaded videos
const dbName='AnimeNexusDB';
const storeName='videos';
let db;

// Initialize database
const openDB=()=>{
  return new Promise((resolve,reject)=>{
    const req=indexedDB.open(dbName,1);
    req.onerror=()=>reject(req.error);
    req.onsuccess=()=>resolve(req.result);
    req.onupgradeneeded=(e)=>{
      const database=e.target.result;
      if(!database.objectStoreNames.contains(storeName)){
        database.createObjectStore(storeName,{keyPath:'id',autoIncrement:true});
      }
    };
  });
};

openDB().then(d=>{db=d;loadUploadedVideos();addSampleVideos();});

const animeDatabase={
  'Cyber Re:Born':{img:'https://image.tmdb.org/t/p/w500/qJ2tW6WMUDux911r6m7haRef0WH.jpg',episodes:12,description:'In 2099 Neo-Kyoto, a rogue AI resurrects a dead hacker to stop an impending digital apocalypse.'},
  'Neon Eclipse':{img:'https://image.tmdb.org/t/p/w500/9ggJ2xHtUvwGaHv8xo9kUI9pD3I.jpg',episodes:8,description:'A thrilling cyberpunk journey through neon-lit streets.'},
  'Ghost in the Shell: SAC_2045':{img:'https://image.tmdb.org/t/p/w500/gt4ia6IgaLlrmKkTkr8e5L2gKZF.jpg',episodes:24,description:'The world is in a state of information warfare and the only way to survive is to change.'},
  'Attack on Titan':{img:'https://image.tmdb.org/t/p/w500/uyKnyU6d7bFXIpHlBcV1kqV3F8a.jpg',episodes:25,description:'Humanity fights for survival against giant humanoid titans that eat people.'},
  'Steins;Gate 0':{img:'https://image.tmdb.org/t/p/w500/h5pAEVmaJRUF8vKEObT6gz8kR8k.jpg',episodes:23,description:'The continuation of a legendary time-travel thriller.'},
  'Chainsaw Man':{img:'https://image.tmdb.org/t/p/w500/6KvpEo4Eg4X2f6MNkW6aR2IBYVL.jpg',episodes:12,description:'A devil hunter with a chainsaw for a head fights for survival.'},
  'Naruto':{img:'https://image.tmdb.org/t/p/w500/fJoLwV3xJIVAjlFWydGwq4yRlKq.jpg',episodes:220,description:'A young ninja with dreams of becoming Hokage works to protect his village and friends.'},
  'Bleach':{img:'https://image.tmdb.org/t/p/w500/Y5j7uSpLKpVOw0j8MWOJmQVHEhG.jpg',episodes:366,description:'A high schooler discovers he can see spirits and becomes a Soul Reaper to protect humans.'},
  'One Piece':{img:'https://image.tmdb.org/t/p/w500/xUeHy6bYuuoTAqV1LpH6I8fQjPu.jpg',episodes:1061,description:'Luffy sails the seas to become the Pirate King and find the legendary treasure.'},
  'Tokyo Ghoul':{img:'https://image.tmdb.org/t/p/w500/7Fwfb5xvQeX9LgaXfqIHPSyAVXW.jpg',episodes:24,description:'A student becomes half-ghoul and must navigate a dark world of creatures.'},
  'Sword Art Online':{img:'https://image.tmdb.org/t/p/w500/4Dv51c9W9qO6VUcGAZ9wHJ9cxCy.jpg',episodes:25,description:'Players trapped in a virtual reality MMO must clear 100 floors to escape.'},
  'Mob Psycho 100':{img:'https://image.tmdb.org/t/p/w500/tfk4xz34sKVOmyj2yz7v0Kxl7fu.jpg',episodes:25,description:'An eighth-grader with psychic powers struggles with school and relationships.'},
  'Cowboy Bebop':{img:'https://image.tmdb.org/t/p/w500/5q0hLJMhcXVzDaVEz9FDiH1HvCf.jpg',episodes:26,description:'A ragtag crew of bounty hunters travels the galaxy in the year 2071.'},
  'Code Geass':{img:'https://image.tmdb.org/t/p/w500/zS0mYZ5qXXZVy5xEKMNb9LqPPb3.jpg',episodes:25,description:'A student gains the power to command anyone and uses it to conquer the world.'},
  'Death Parade':{img:'https://image.tmdb.org/t/p/w500/uRc4fgPpfHcddaVvjpfmH1klBuJ.jpg',episodes:12,description:'Souls arrive at a bar where they play games that reveal their true nature.'},
  'Ergo Proxy':{img:'https://image.tmdb.org/t/p/w500/4TdVqMj2RpJ47VpKJEOkdJ8QKtV.jpg',episodes:23,description:'A post-apocalyptic journey through a dark, atmospheric world.'},
  'Neon Genesis Evangelion':{img:'https://image.tmdb.org/t/p/w500/2rBGp03T3iXKGQDFOqXWvQdqFJy.jpg',episodes:26,description:'Teenagers pilot giant robots to protect Earth from mysterious invaders.'},
  'Demon Slayer':{img:'https://image.tmdb.org/t/p/w500/r02wd8PzqkPAr8ogHwsn8706djm.jpg',episodes:26,description:'Tanjiro trains to become a Demon Slayer and save his sister from curse.'},
  'Jujutsu Kaisen':{img:'https://image.tmdb.org/t/p/w500/gqz5r6nSUvIFV3k0bPvlJkOQpwv.jpg',episodes:24,description:'Yuji Itadori becomes host to the King of Curses and joins a secret society.'},
  'My Hero Academia':{img:'https://image.tmdb.org/t/p/w500/PxRXlDu92ZV20yF8f9vj8BHRlQ5.jpg',episodes:88,description:'A powerless boy attends a school for superheroes to achieve his dream.'},
  'Hunter x Hunter':{img:'https://image.tmdb.org/t/p/w500/HKB3t8R2B6h7jFNr5Kzqg8EgKEo.jpg',episodes:148,description:'A young boy embarks on an adventure to become a Hunter and find his father.'},
  'Fullmetal Alchemist':{img:'https://image.tmdb.org/t/p/w500/3c5LqaYzlMqqFgCEkkk4r2H7rkG.jpg',episodes:51,description:'Two brothers seek the Philosopher\'s Stone to restore their bodies after a forbidden ritual.'},
  'Fullmetal Alchemist: Brotherhood':{img:'https://image.tmdb.org/t/p/w500/8d8BKVfIV4eVCKsxQvI0eFGvkup.jpg',episodes:64,description:'The complete retelling of two brothers\' quest with new characters and deeper story.'},
  'Steins;Gate':{img:'https://image.tmdb.org/t/p/w500/STJUx8Z5CG9pWfkuWqP5l3f8m5L.jpg',episodes:24,description:'A college student discovers how to send messages to the past and alters timelines.'},
  'Psycho-Pass':{img:'https://image.tmdb.org/t/p/w500/qWbT3UeQYYjh0eFGmEqfMPswW1r.jpg',episodes:22,description:'A law enforcement agency uses technology to identify criminals before they commit crimes.'},
  'Parasyte':{img:'https://image.tmdb.org/t/p/w500/xJmvLh3PnXTEeGxYiQ5lJKQBdma.jpg',episodes:24,description:'A student shares his body with an alien parasite and they form an unlikely bond.'},
  'Vinland Saga':{img:'https://image.tmdb.org/t/p/w500/mVr3VJptLvVfzoVnq5HnWnJUZgX.jpg',episodes:24,description:'A Viking warrior seeks revenge in a brutal historical epic.'},
  'Spy x Family':{img:'https://image.tmdb.org/t/p/w500/gzFRoWNyJwAE2CWWzYMwBKu40rR.jpg',episodes:25,description:'An spy, assassin, and telepath form a fake family for a mission.'},
  'The Promised Neverland':{img:'https://image.tmdb.org/t/p/w500/FYITkqNzXXMrMCPnC0eNmBnuNFd.jpg',episodes:12,description:'Orphans discover their orphanage is actually a farm and plan their escape.'},
  'Cyberpunk: Edgerunners':{img:'https://image.tmdb.org/t/p/w500/4gMQb2nMRsX9s8MxDEb1nGCwEqN.jpg',episodes:10,description:'A street kid and a cybernetic soldier form an unlikely partnership in Night City.'},
  'Kill la Kill':{img:'https://image.tmdb.org/t/p/w500/hHqU03DWBb3HeLhZLfHMKRaY89n.jpg',episodes:24,description:'A girl seeks revenge against a powerful academy using a sentient school uniform.'},
  'RWBY':{img:'https://image.tmdb.org/t/p/w500/oRVQQRTU88tP9e2HqIHx5XZAhEL.jpg',episodes:65,description:'Young huntresses train to protect their world from dangerous creatures.'},
  'Fate/stay night':{img:'https://image.tmdb.org/t/p/w500/wNSRKDdkZKx0WBp7fFPaE8xHGKq.jpg',episodes:24,description:'A student is drawn into a magical war between powerful summoned heroes.'},
  'Puella Magi Madoka Magica':{img:'https://image.tmdb.org/t/p/w500/3Ct8FBxEqPHt8qAkGG4MtY6xGi9.jpg',episodes:12,description:'Girls are offered magical powers but discover a dark truth behind the gift.'},
  'Assassination Classroom':{img:'https://image.tmdb.org/t/p/w500/yCSWDX4mFKVpnA6HXjRx5Ux2x9j.jpg',episodes:47,description:'A powerful octopus-like creature becomes a teacher and the students must kill him.'},
  'Food Wars!':{img:'https://image.tmdb.org/t/p/w500/qT0MXVzg3gLEhLvuNn9O5K0RP0e.jpg',episodes:86,description:'Students compete in intense culinary battles at an elite cooking school.'},
  'Haikyuu!!':{img:'https://image.tmdb.org/t/p/w500/rvLvLX0DW9gj1VlZMmRL9K5XscM.jpg',episodes:85,description:'A volleyball team works together to win nationals and overcome their rivals.'},
  'Mob Psycho 100 II':{img:'https://image.tmdb.org/t/p/w500/1HPR0pZGKYhL04GJqfMB1jkLsEg.jpg',episodes:13,description:'Mob continues his journey as a psychic dealing with romance and self-discovery.'},
  'Re:Zero':{img:'https://image.tmdb.org/t/p/w500/ZvMYlnB9LyNZx3bXhA4jIcLxSEI.jpg',episodes:25,description:'A student is transported to a fantasy world and discovers he can rewind time.'},
  'Overlord':{img:'https://image.tmdb.org/t/p/w500/b1NhIAur0zkJ3aLLjzlCCgZfFNH.jpg',episodes:52,description:'A powerful skeleton lord traverses a fantasy world with his guild of undead.'},
  'That Time I Got Reincarnated as a Slime':{img:'https://image.tmdb.org/t/p/w500/SZf8L6Ke8kHKNuqCt7oHEwXX2yR.jpg',episodes:48,description:'A man reincarnates as a slime and becomes the leader of a monster nation.'},
  'Solo Leveling':{img:'https://image.tmdb.org/t/p/w500/WMiBJqVzW0VzBaVJx8RVzV0h1r6.jpg',episodes:12,description:'A weak hunter discovers he can gain power by defeating increasingly dangerous monsters.'},
  'Blue Exorcist':{img:'https://image.tmdb.org/t/p/w500/pQXjBPEeJqZwKNwbmVZA3q3pYY4.jpg',episodes:25,description:'A boy discovers he is the son of Satan and must become an exorcist.'},
  'Seraph of the End':{img:'https://image.tmdb.org/t/p/w500/c4xHdVHJQGH6FQNT4A4YlRGdKVb.jpg',episodes:24,description:'Orphans battle vampires and demons in a post-apocalyptic world.'},
  'Angels and Demons':{img:'https://image.tmdb.org/t/p/w500/rlhVzKTwJ2iQlR7ZRB1v6yCh0n2.jpg',episodes:12,description:'An angel and demon are forced to work together in the human world.'},
  'Megalobox':{img:'https://image.tmdb.org/t/p/w500/8qQIlDWnLFLRPAyiRoVfRWELfNQ.jpg',episodes:13,description:'An underdog boxer fights in illegal underground matches to reach the championship.'},
  'Carole & Tuesday':{img:'https://image.tmdb.org/t/p/w500/q51r8o6CfILn3GxQdHAJwWVxCRt.jpg',episodes:24,description:'Two musicians form a band on Mars and rise to stardom through their music.'},
  'Michiko & Hatchin':{img:'https://image.tmdb.org/t/p/w500/r8HzG0JIpVfJPuQSRRYTHJJqDy1.jpg',episodes:25,description:'A woman and a young boy form an unlikely bond on a journey across Japan.'},
  'March Comes in Like a Lion':{img:'https://image.tmdb.org/t/p/w500/xg9e4qpN8H6VnqRqyaJjR5o2a2u.jpg',episodes:44,description:'A shogi prodigy struggles with depression while finding warmth in new friendships.'},
  'Ping Pong the Animation':{img:'https://image.tmdb.org/t/p/w500/lhHLDwL33Kw6ryb8eNq6MqY6hNG.jpg',episodes:11,description:'Two childhood friends become rivals in competitive table tennis.'},
  'Your Name':{img:'https://image.tmdb.org/t/p/w500/rEcj5XEzIW5NkiJ8bUc2VDLMJk8.jpg',episodes:1,description:'Two teenagers mysteriously swap bodies and must find each other to break the curse.'},
  'A Silent Voice':{img:'https://image.tmdb.org/t/p/w500/YoJxifCHbgQ6iHgzZ8WlQyRrxQu.jpg',episodes:1,description:'A reformed bully reconnects with his deaf classmate to make amends.'},
  'Fruits Basket':{img:'https://image.tmdb.org/t/p/w500/Zk1sJvK8u2FU50sGWd3L0wMKPpx.jpg',episodes:63,description:'A girl discovers a family cursed to transform into zodiac animals.'},
  'Sailor Moon':{img:'https://image.tmdb.org/t/p/w500/eOIUGDXKKyE6aSHX2H3pN5YGNbE.jpg',episodes:200,description:'Teenage girls with magical powers protect Earth from supernatural threats.'},
  'Ouran High School Host Club':{img:'https://image.tmdb.org/t/p/w500/c7VlBCG7jZIDM7pKc34yFsgYN3p.jpg',episodes:26,description:'A girl joins an elite school\'s host club and forms unexpected bonds.'},
  'Toradora!':{img:'https://image.tmdb.org/t/p/w500/wjJZM1ZF3EllKr2R8E0J9R5f1ej.jpg',episodes:25,description:'A tough girl and a kind boy help each other pursue their crushes.'},
  'The Devil is a Part-Timer':{img:'https://image.tmdb.org/t/p/w500/TQqTiBG8iJFD9bhmJMfqw7tHWpD.jpg',episodes:13,description:'A demon lord works a part-time job to survive in modern Japan.'},
  'Angel Beats!':{img:'https://image.tmdb.org/t/p/w500/A2KPUSLvOK6cXZqmfI2Rk1q8PSq.jpg',episodes:13,description:'A group of teenagers discover they\'re in the afterlife and must find peace.'},
  'Clannad':{img:'https://image.tmdb.org/t/p/w500/wgFMKR4xvO0RNNXpn8uC1lZfVxL.jpg',episodes:48,description:'A high schooler forms bonds with mysterious girls in his school.'},
  'Tokyo Mew Mew':{img:'https://image.tmdb.org/t/p/w500/iq7N3ib3YVDl5aqhfWdHCLjVcsV.jpg',episodes:52,description:'Girls are transformed into cat-human hybrids to fight invading aliens.'},
  'Little Witch Academia':{img:'https://image.tmdb.org/t/p/w500/w2GqvhB1aUpU4wY5ESmV8VfM4Xf.jpg',episodes:25,description:'A non-magical girl attends a prestigious magic academy and pursues her dreams.'},
  'Keijo!!!!!!!!':{img:'https://image.tmdb.org/t/p/w500/7ioJDL8K6xHJwUSG8hxELHVqEiE.jpg',episodes:12,description:'Girls compete in a sport where they fight only using their butts and breasts.'},
  'Akame ga Kill!':{img:'https://image.tmdb.org/t/p/w500/VwpNFJMUJw1yI2y5hs1lxX5kRrz.jpg',episodes:24,description:'Assassins with cursed weapons fight against a corrupt empire.'},
  'DanMachi':{img:'https://image.tmdb.org/t/p/w500/8fqVLvFt0nNw5uH4W7YnLT3EbPm.jpg',episodes:48,description:'A young adventurer trains in a dungeon filled with monsters and treasure.'},
  'Made in Abyss':{img:'https://image.tmdb.org/t/p/w500/c2jIu4AYc9Q8c4eG0fqNDgLDnq8.jpg',episodes:13,description:'Children explore a massive pit filled with ancient relics and mysteries.'},
  'Tower of God':{img:'https://image.tmdb.org/t/p/w500/KaMfDL1PdCVFNSY18p3mYhYGq4e.jpg',episodes:13,description:'A young man climbs a mysterious tower to find his lost friend.'},
  'Vinland Saga Season 2':{img:'https://image.tmdb.org/t/p/w500/mVr3VJptLvVfzoVnq5HnWnJUZgX.jpg',episodes:24,description:'Thorfinn embarks on a new journey seeking revenge and redemption.'},
  'Wind Breaker':{img:'https://image.tmdb.org/t/p/w500/7B5aHgqFFEQzJlsmCQVPPyWVYyc.jpg',episodes:13,description:'A transfer student learns to fight and protect his neighborhood.'},
  'The God of High School':{img:'https://image.tmdb.org/t/p/w500/ijPxD3vB2XvVZl3e5S0LvRVIB6d.jpg',episodes:13,description:'High school students compete in an epic martial arts tournament.'},
  'My Dress-Up Darling':{img:'https://image.tmdb.org/t/p/w500/lJPJ6pE2aXBNRwkCWTKhqyPb4pf.jpg',episodes:12,description:'A shy boy helps a girl create cosplay outfits while they fall in love.'},
  'Jigoku Shoujo':{img:'https://image.tmdb.org/t/p/w500/V5wRdJVPCqBkJJGKSDPmRQdEkJp.jpg',episodes:26,description:'A mysterious girl sends people to hell at the cost of their souls.'},
  'Danganronpa':{img:'https://image.tmdb.org/t/p/w500/8g0Lfr0hC6jnL7Rq4uQnKmLfLz8.jpg',episodes:13,description:'Students are forced into a killing game where they must solve murders.'},
  'Classroom of the Elite':{img:'https://image.tmdb.org/t/p/w500/g8nozQmCqrN1eYfCVQaGM9I8eFl.jpg',episodes:25,description:'A genius student helps his class navigate an elite academy\'s secrets.'},
  'Kabaneri of the Iron Fortress':{img:'https://image.tmdb.org/t/p/w500/7g6P8aQeYi5EdhG2xk1Yoq2YrjE.jpg',episodes:12,description:'A boy fights zombie-like creatures as a train races across a dangerous land.'}
};

const posters=[
  {title:'Cyber Re:Born',img:'https://image.tmdb.org/t/p/w500/qJ2tW6WMUDux911r6m7haRef0WH.jpg',ep:'Ep 12'},
  {title:'Neon Eclipse',img:'https://image.tmdb.org/t/p/w500/9ggJ2xHtUvwGaHv8xo9kUI9pD3I.jpg',ep:'Ep 8'},
  {title:'Ghost in the Shell: SAC_2045',img:'https://image.tmdb.org/t/p/w500/gt4ia6IgaLlrmKkTkr8e5L2gKZF.jpg',ep:'Ep 24'},
  {title:'Attack on Titan',img:'https://image.tmdb.org/t/p/w500/uyKnyU6d7bFXIpHlBcV1kqV3F8a.jpg',ep:'Ep 25'},
  {title:'Steins;Gate 0',img:'https://image.tmdb.org/t/p/w500/h5pAEVmaJRUF8vKEObT6gz8kR8k.jpg',ep:'Ep 23'},
  {title:'Chainsaw Man',img:'https://image.tmdb.org/t/p/w500/6KvpEo4Eg4X2f6MNkW6aR2IBYVL.jpg',ep:'Ep 12'},
  {title:'Naruto',img:'https://image.tmdb.org/t/p/w500/fJoLwV3xJIVAjlFWydGwq4yRlKq.jpg',ep:'Ep 220'},
  {title:'Bleach',img:'https://image.tmdb.org/t/p/w500/Y5j7uSpLKpVOw0j8MWOJmQVHEhG.jpg',ep:'Ep 366'},
  {title:'One Piece',img:'https://image.tmdb.org/t/p/w500/xUeHy6bYuuoTAqV1LpH6I8fQjPu.jpg',ep:'Ep 1061'},
  {title:'Tokyo Ghoul',img:'https://image.tmdb.org/t/p/w500/7Fwfb5xvQeX9LgaXfqIHPSyAVXW.jpg',ep:'Ep 24'},
  {title:'Sword Art Online',img:'https://image.tmdb.org/t/p/w500/4Dv51c9W9qO6VUcGAZ9wHJ9cxCy.jpg',ep:'Ep 25'},
  {title:'Mob Psycho 100',img:'https://image.tmdb.org/t/p/w500/tfk4xz34sKVOmyj2yz7v0Kxl7fu.jpg',ep:'Ep 25'},
  {title:'Cowboy Bebop',img:'https://image.tmdb.org/t/p/w500/5q0hLJMhcXVzDaVEz9FDiH1HvCf.jpg',ep:'Ep 26'},
  {title:'Code Geass',img:'https://image.tmdb.org/t/p/w500/zS0mYZ5qXXZVy5xEKMNb9LqPPb3.jpg',ep:'Ep 25'},
  {title:'Death Parade',img:'https://image.tmdb.org/t/p/w500/uRc4fgPpfHcddaVvjpfmH1klBuJ.jpg',ep:'Ep 12'},
  {title:'Ergo Proxy',img:'https://image.tmdb.org/t/p/w500/4TdVqMj2RpJ47VpKJEOkdJ8QKtV.jpg',ep:'Ep 23'},
  {title:'Neon Genesis Evangelion',img:'https://image.tmdb.org/t/p/w500/2rBGp03T3iXKGQDFOqXWvQdqFJy.jpg',ep:'Ep 26'},
  {title:'Demon Slayer',img:'https://image.tmdb.org/t/p/w500/r02wd8PzqkPAr8ogHwsn8706djm.jpg',ep:'Ep 26'},
  {title:'Jujutsu Kaisen',img:'https://image.tmdb.org/t/p/w500/gqz5r6nSUvIFV3k0bPvlJkOQpwv.jpg',ep:'Ep 24'},
  {title:'My Hero Academia',img:'https://image.tmdb.org/t/p/w500/PxRXlDu92ZV20yF8f9vj8BHRlQ5.jpg',ep:'Ep 88'},
  {title:'Hunter x Hunter',img:'https://image.tmdb.org/t/p/w500/HKB3t8R2B6h7jFNr5Kzqg8EgKEo.jpg',ep:'Ep 148'},
  {title:'Fullmetal Alchemist',img:'https://image.tmdb.org/t/p/w500/3c5LqaYzlMqqFgCEkkk4r2H7rkG.jpg',ep:'Ep 51'},
  {title:'Fullmetal Alchemist: Brotherhood',img:'https://image.tmdb.org/t/p/w500/8d8BKVfIV4eVCKsxQvI0eFGvkup.jpg',ep:'Ep 64'},
  {title:'Steins;Gate',img:'https://image.tmdb.org/t/p/w500/STJUx8Z5CG9pWfkuWqP5l3f8m5L.jpg',ep:'Ep 24'},
  {title:'Psycho-Pass',img:'https://image.tmdb.org/t/p/w500/qWbT3UeQYYjh0eFGmEqfMPswW1r.jpg',ep:'Ep 22'},
  {title:'Parasyte',img:'https://image.tmdb.org/t/p/w500/xJmvLh3PnXTEeGxYiQ5lJKQBdma.jpg',ep:'Ep 24'},
  {title:'Vinland Saga',img:'https://image.tmdb.org/t/p/w500/mVr3VJptLvVfzoVnq5HnWnJUZgX.jpg',ep:'Ep 24'},
  {title:'Spy x Family',img:'https://image.tmdb.org/t/p/w500/gzFRoWNyJwAE2CWWzYMwBKu40rR.jpg',ep:'Ep 25'},
  {title:'The Promised Neverland',img:'https://image.tmdb.org/t/p/w500/FYITkqNzXXMrMCPnC0eNmBnuNFd.jpg',ep:'Ep 12'},
  {title:'Cyberpunk: Edgerunners',img:'https://image.tmdb.org/t/p/w500/4gMQb2nMRsX9s8MxDEb1nGCwEqN.jpg',ep:'Ep 10'},
  {title:'Kill la Kill',img:'https://image.tmdb.org/t/p/w500/hHqU03DWBb3HeLhZLfHMKRaY89n.jpg',ep:'Ep 24'},
  {title:'RWBY',img:'https://image.tmdb.org/t/p/w500/oRVQQRTU88tP9e2HqIHx5XZAhEL.jpg',ep:'Ep 65'},
  {title:'Fate/stay night',img:'https://image.tmdb.org/t/p/w500/wNSRKDdkZKx0WBp7fFPaE8xHGKq.jpg',ep:'Ep 24'},
  {title:'Puella Magi Madoka Magica',img:'https://image.tmdb.org/t/p/w500/3Ct8FBxEqPHt8qAkGG4MtY6xGi9.jpg',ep:'Ep 12'},
  {title:'Assassination Classroom',img:'https://image.tmdb.org/t/p/w500/yCSWDX4mFKVpnA6HXjRx5Ux2x9j.jpg',ep:'Ep 47'},
  {title:'Food Wars!',img:'https://image.tmdb.org/t/p/w500/qT0MXVzg3gLEhLvuNn9O5K0RP0e.jpg',ep:'Ep 86'},
  {title:'Haikyuu!!',img:'https://image.tmdb.org/t/p/w500/rvLvLX0DW9gj1VlZMmRL9K5XscM.jpg',ep:'Ep 85'},
  {title:'Mob Psycho 100 II',img:'https://image.tmdb.org/t/p/w500/1HPR0pZGKYhL04GJqfMB1jkLsEg.jpg',ep:'Ep 13'},
  {title:'Re:Zero',img:'https://image.tmdb.org/t/p/w500/ZvMYlnB9LyNZx3bXhA4jIcLxSEI.jpg',ep:'Ep 25'},
  {title:'Overlord',img:'https://image.tmdb.org/t/p/w500/b1NhIAur0zkJ3aLLjzlCCgZfFNH.jpg',ep:'Ep 52'},
  {title:'That Time I Got Reincarnated as a Slime',img:'https://image.tmdb.org/t/p/w500/SZf8L6Ke8kHKNuqCt7oHEwXX2yR.jpg',ep:'Ep 48'},
  {title:'Solo Leveling',img:'https://image.tmdb.org/t/p/w500/WMiBJqVzW0VzBaVJx8RVzV0h1r6.jpg',ep:'Ep 12'},
  {title:'Blue Exorcist',img:'https://image.tmdb.org/t/p/w500/pQXjBPEeJqZwKNwbmVZA3q3pYY4.jpg',ep:'Ep 25'},
  {title:'Seraph of the End',img:'https://image.tmdb.org/t/p/w500/c4xHdVHJQGH6FQNT4A4YlRGdKVb.jpg',ep:'Ep 24'},
  {title:'Angels and Demons',img:'https://image.tmdb.org/t/p/w500/rlhVzKTwJ2iQlR7ZRB1v6yCh0n2.jpg',ep:'Ep 12'},
  {title:'Megalobox',img:'https://image.tmdb.org/t/p/w500/8qQIlDWnLFLRPAyiRoVfRWELfNQ.jpg',ep:'Ep 13'},
  {title:'Carole & Tuesday',img:'https://image.tmdb.org/t/p/w500/q51r8o6CfILn3GxQdHAJwWVxCRt.jpg',ep:'Ep 24'},
  {title:'Michiko & Hatchin',img:'https://image.tmdb.org/t/p/w500/r8HzG0JIpVfJPuQSRRYTHJJqDy1.jpg',ep:'Ep 25'},
  {title:'March Comes in Like a Lion',img:'https://image.tmdb.org/t/p/w500/xg9e4qpN8H6VnqRqyaJjR5o2a2u.jpg',ep:'Ep 44'},
  {title:'Ping Pong the Animation',img:'https://image.tmdb.org/t/p/w500/lhHLDwL33Kw6ryb8eNq6MqY6hNG.jpg',ep:'Ep 11'},
  {title:'Your Name',img:'https://image.tmdb.org/t/p/w500/rEcj5XEzIW5NkiJ8bUc2VDLMJk8.jpg',ep:'Ep 1'},
  {title:'A Silent Voice',img:'https://image.tmdb.org/t/p/w500/YoJxifCHbgQ6iHgzZ8WlQyRrxQu.jpg',ep:'Ep 1'},
  {title:'Fruits Basket',img:'https://image.tmdb.org/t/p/w500/Zk1sJvK8u2FU50sGWd3L0wMKPpx.jpg',ep:'Ep 63'},
  {title:'Sailor Moon',img:'https://image.tmdb.org/t/p/w500/eOIUGDXKKyE6aSHX2H3pN5YGNbE.jpg',ep:'Ep 200'},
  {title:'Ouran High School Host Club',img:'https://image.tmdb.org/t/p/w500/c7VlBCG7jZIDM7pKc34yFsgYN3p.jpg',ep:'Ep 26'},
  {title:'Toradora!',img:'https://image.tmdb.org/t/p/w500/wjJZM1ZF3EllKr2R8E0J9R5f1ej.jpg',ep:'Ep 25'},
  {title:'The Devil is a Part-Timer',img:'https://image.tmdb.org/t/p/w500/TQqTiBG8iJFD9bhmJMfqw7tHWpD.jpg',ep:'Ep 13'},
  {title:'Angel Beats!',img:'https://image.tmdb.org/t/p/w500/A2KPUSLvOK6cXZqmfI2Rk1q8PSq.jpg',ep:'Ep 13'},
  {title:'Clannad',img:'https://image.tmdb.org/t/p/w500/wgFMKR4xvO0RNNXpn8uC1lZfVxL.jpg',ep:'Ep 48'},
  {title:'Tokyo Mew Mew',img:'https://image.tmdb.org/t/p/w500/iq7N3ib3YVDl5aqhfWdHCLjVcsV.jpg',ep:'Ep 52'},
  {title:'Little Witch Academia',img:'https://image.tmdb.org/t/p/w500/w2GqvhB1aUpU4wY5ESmV8VfM4Xf.jpg',ep:'Ep 25'},
  {title:'Keijo!!!!!!!',img:'https://image.tmdb.org/t/p/w500/7ioJDL8K6xHJwUSG8hxELHVqEiE.jpg',ep:'Ep 12'},
  {title:'Akame ga Kill!',img:'https://image.tmdb.org/t/p/w500/VwpNFJMUJw1yI2y5hs1lxX5kRrz.jpg',ep:'Ep 24'},
  {title:'DanMachi',img:'https://image.tmdb.org/t/p/w500/8fqVLvFt0nNw5uH4W7YnLT3EbPm.jpg',ep:'Ep 48'},
  {title:'Made in Abyss',img:'https://image.tmdb.org/t/p/w500/c2jIu4AYc9Q8c4eG0fqNDgLDnq8.jpg',ep:'Ep 13'},
  {title:'Tower of God',img:'https://image.tmdb.org/t/p/w500/KaMfDL1PdCVFNSY18p3mYhYGq4e.jpg',ep:'Ep 13'},
  {title:'Vinland Saga Season 2',img:'https://image.tmdb.org/t/p/w500/mVr3VJptLvVfzoVnq5HnWnJUZgX.jpg',ep:'Ep 24'},
  {title:'Wind Breaker',img:'https://image.tmdb.org/t/p/w500/7B5aHgqFFEQzJlsmCQVPPyWVYyc.jpg',ep:'Ep 13'},
  {title:'The God of High School',img:'https://image.tmdb.org/t/p/w500/ijPxD3vB2XvVZl3e5S0LvRVIB6d.jpg',ep:'Ep 13'},
  {title:'My Dress-Up Darling',img:'https://image.tmdb.org/t/p/w500/lJPJ6pE2aXBNRwkCWTKhqyPb4pf.jpg',ep:'Ep 12'},
  {title:'Jigoku Shoujo',img:'https://image.tmdb.org/t/p/w500/V5wRdJVPCqBkJJGKSDPmRQdEkJp.jpg',ep:'Ep 26'},
  {title:'Danganronpa',img:'https://image.tmdb.org/t/p/w500/8g0Lfr0hC6jnL7Rq4uQnKmLfLz8.jpg',ep:'Ep 13'},
  {title:'Classroom of the Elite',img:'https://image.tmdb.org/t/p/w500/g8nozQmCqrN1eYfCVQaGM9I8eFl.jpg',ep:'Ep 25'},
  {title:'Kabaneri of the Iron Fortress',img:'https://image.tmdb.org/t/p/w500/7g6P8aQeYi5EdhG2xk1Yoq2YrjE.jpg',ep:'Ep 12'}
];

function openUploadModal(){document.getElementById('uploadModal').classList.add('active');}
function closeUploadModal(){document.getElementById('uploadModal').classList.remove('active');}

const dragZone=document.getElementById('dragZone');
const videoFile=document.getElementById('videoFile');
['dragenter','dragover'].forEach(e=>dragZone.addEventListener(e,()=>dragZone.classList.add('dragover')));
['dragleave','drop'].forEach(e=>dragZone.addEventListener(e,()=>dragZone.classList.remove('dragover')));
dragZone.addEventListener('drop',(e)=>{e.preventDefault();if(e.dataTransfer.files[0])videoFile.files=e.dataTransfer.files;});

function uploadVideo(){
  const title=document.getElementById('animeTitle').value.trim();
  const ep=parseInt(document.getElementById('episodeNum').value);
  const desc=document.getElementById('description').value.trim();
  const file=document.getElementById('videoFile').files[0];
  
  if(!title||!ep||!file)return alert('Please fill all fields and select a video');
  
  const reader=new FileReader();
  reader.onload=(e)=>{
    const video={id:Date.now(),title,ep,desc,blob:e.target.result,size:(file.size/1024/1024).toFixed(2)};
    const tx=db.transaction(storeName,'readwrite');
    tx.objectStore(storeName).add(video);
    tx.oncomplete=()=>{
      document.getElementById('animeTitle').value='';
      document.getElementById('episodeNum').value='';
      document.getElementById('description').value='';
      document.getElementById('videoFile').value='';
      loadUploadedVideos();
      closeUploadModal();
      alert('Video uploaded successfully!');
    };
  };
  reader.readAsArrayBuffer(file);
}

function loadUploadedVideos(){
  if(!db)return;
  const tx=db.transaction(storeName,'readonly');
  const req=tx.objectStore(storeName).getAll();
  req.onsuccess=()=>{
    const html=req.result.length?'<h3>Your Uploaded Videos</h3>'+req.result.map(v=>`
      <div class="video-item">
        <div class="video-item-info">
          <div class="video-item-title">${v.title} - Ep ${v.ep}</div>
          <div class="video-item-size">${v.size} MB</div>
        </div>
        <button class="btn-delete" onclick="deleteVideo(${v.id})">Delete</button>
      </div>
    `).join(''):'';
    document.getElementById('uploadedVideos').innerHTML=html;
  };
}

function addSampleVideos(){
  if(!db)return;
  const tx=db.transaction(storeName,'readonly');
  const req=tx.objectStore(storeName).getAll();
  req.onsuccess=()=>{
    if(req.result.length===0){
      const samples=[
        {title:'Demon Slayer',ep:1,desc:'Tanjiro and Nezuko embark on a journey to find a cure for Nezuko\'s demon curse.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/BigBuckBunny.mp4'},
        {title:'Demon Slayer',ep:2,desc:'Tanjiro enters the Final Selection exam to become a Demon Slayer.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/ElephantsDream.mp4'},
        {title:'Jujutsu Kaisen',ep:1,desc:'Yuji Itadori becomes the host of Ryomen Sukuna, the King of Curses.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/ForBiggerBlazes.mp4'},
        {title:'Jujutsu Kaisen',ep:2,desc:'Yuji meets Gojo and learns about the Jujutsu world.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/BigBuckBunny.mp4'},
        {title:'My Hero Academia',ep:1,desc:'Deku dreams of becoming a hero despite being powerless in a superpowered world.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/ElephantsDream.mp4'},
        {title:'My Hero Academia',ep:2,desc:'All Might gives Deku a chance at becoming a hero.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/ForBiggerBlazes.mp4'},
        {title:'Death Note',ep:1,desc:'Light Yagami discovers a notebook with the power to kill anyone.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/BigBuckBunny.mp4'},
        {title:'Death Note',ep:2,desc:'Light uses the Death Note to eliminate criminals.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/ElephantsDream.mp4'},
        {title:'One Punch Man',ep:1,desc:'Saitama, an overpowered hero, searches for worthy opponents.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/ForBiggerBlazes.mp4'},
        {title:'One Punch Man',ep:2,desc:'Saitama meets Genos, a cyborg seeking his mentorship.',video:'https://commondatastorage.googleapis.com/gtv-videos-library/sample/BigBuckBunny.mp4'}
      ];
      
      samples.forEach((s,i)=>{
        fetch(s.video)
          .then(r=>r.arrayBuffer())
          .then(blob=>{
            const video={id:10000+i,title:s.title,ep:s.ep,desc:s.desc,blob:blob,size:'2.50'};
            const tx2=db.transaction(storeName,'readwrite');
            tx2.objectStore(storeName).add(video);
            tx2.oncomplete=()=>{if(i===samples.length-1)loadUploadedVideos();};
          });
      });
    }
  };
}

function deleteVideo(id){
  if(!db)return;
  const tx=db.transaction(storeName,'readwrite');
  tx.objectStore(storeName).delete(id);
  tx.oncomplete=()=>{loadUploadedVideos();};
}

function playUploadedVideo(id){
  if(!db)return;
  const tx=db.transaction(storeName,'readonly');
  const req=tx.objectStore(storeName).get(id);
  req.onsuccess=()=>{
    const video=req.result;
    if(!video)return;
    const blob=new Blob([video.blob],{type:'video/mp4'});
    const url=URL.createObjectURL(blob);
    const player=document.getElementById('videoPlayer');
    player.innerHTML=`<video width="100%" height="100%" controls style="background:#000"><source src="${url}" type="video/mp4"></video>`;
    document.querySelector('.anime-title').textContent=video.title;
    document.querySelector('.episode-num').textContent=`Episode ${video.ep}`;
    document.querySelector('.anime-description').textContent=video.desc;
  };
}

function card(an){
  const div=document.createElement('div');div.className='shelf-item';div.style.cursor='pointer';
  div.innerHTML=`<img src="${an.img}" alt="${an.title}"><div class="shelf-meta"><div class="title">${an.title}</div><div class="ep">${an.ep}</div></div>`;
  div.onclick=()=>watchAnime(an.title);
  return div;
}

function watchAnime(title){
  document.getElementById('homePage').classList.add('hidden');
  document.getElementById('watchPage').classList.add('active');
  const anime=animeDatabase[title];
  if(!anime)return;
  loadEpisodes(title,anime);
  playEpisode(title,1);
}

function goHome(){
  document.getElementById('watchPage').classList.remove('active');
  document.getElementById('homePage').classList.remove('hidden');
}

function loadEpisodes(title,anime){
  const list=document.getElementById('episodesList');
  list.innerHTML=`<h3>${title}</h3>`;
  
  // Load uploaded episodes for this anime
  if(db){
    const tx=db.transaction(storeName,'readonly');
    const req=tx.objectStore(storeName).getAll();
    req.onsuccess=()=>{
      const uploaded=req.result.filter(v=>v.title===title);
      uploaded.forEach(v=>{
        const btn=document.createElement('button');
        btn.className='episode-btn';
        btn.textContent=`Episode ${v.ep} ‚¨ÜÔ∏è`;
        btn.style.background='rgba(255,0,102,.2)';
        btn.style.borderColor='rgba(255,0,102,.5)';
        btn.onclick=()=>playUploadedVideo(v.id);
        list.appendChild(btn);
      });
    };
  }
  
  // Load default episodes
  for(let i=1;i<=anime.episodes;i++){
    const btn=document.createElement('button');
    btn.className='episode-btn';if(i===1&&!document.querySelector('.episode-btn.active'))btn.classList.add('active');
    btn.textContent=`Episode ${i}`;
    btn.onclick=()=>playEpisode(title,i);
    list.appendChild(btn);
  }
}

function playEpisode(title,ep){
  const player=document.getElementById('videoPlayer');
  const anime=animeDatabase[title];
  document.querySelector('.episode-btn.active')?.classList.remove('active');
  document.querySelectorAll('.episode-btn')[ep-1]?.classList.add('active');
  const videoUrl='https://commondatastorage.googleapis.com/gtv-videos-library/sample/BigBuckBunny.mp4';
  player.innerHTML=`<video width="100%" height="100%" controls style="background:#000"><source src="${videoUrl}" type="video/mp4">Your browser does not support the video tag.</video>`;
  document.querySelector('.anime-title').textContent=title;
  document.querySelector('.episode-num').textContent=`Episode ${ep} of ${anime.episodes}`;
  document.querySelector('.anime-description').textContent=anime.description;
}

['trending','new','classics'].forEach(k=>{
  const track=document.querySelector(`[data-shelf=${k}] .shelf-track`);
  posters.forEach(p=>{
    const c=card(p);
    if(k==='new'){const pill=document.createElement('span');pill.className='new-pill';pill.textContent='NEW';c.append(pill);}
    track.append(c);
  });
});

document.querySelector('.watch-container').innerHTML=`
  <button class="back-btn" onclick="goHome()">‚Üê Back to Home</button>
  <div class="video-section">
    <div>
      <div class="video-player" id="videoPlayer"></div>
      <div class="video-info">
        <h2 class="anime-title"></h2>
        <p class="episode-num"></p>
        <p class="anime-description"></p>
      </div>
    </div>
    <div class="episodes-list" id="episodesList"></div>
  </div>
`;
</script>
</body>
</html>
